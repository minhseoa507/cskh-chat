<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Admin CSKH 507 - ProVip</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:600,400&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(120deg,#fffbe7 0%,#00c6fb 100%);
            min-height: 100vh;
            margin: 0;
            font-family: 'Montserrat', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .chat-box {
            background: rgba(255,255,255,0.99);
            box-shadow: 0 8px 40px rgba(44,62,80,0.13);
            border-radius: 28px;
            padding: 38px 28px 18px 28px;
            width: 440px;
            max-width: 99vw;
            animation: popin 0.7s cubic-bezier(.68,-0.55,.27,1.55);
        }
        @keyframes popin {
            0% { transform: scale(0.7); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .chat-header {
            font-size: 2rem;
            font-weight: 700;
            color: #f68084;
            margin-bottom: 10px;
            text-align: center;
            letter-spacing: 2px;
        }
        #clients {
            margin-bottom: 16px;
            text-align: center;
        }
        #clients button {
            margin: 2px 4px 6px 0;
            padding: 7px 14px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(120deg,#00c6fb 0%,#f68084 100%);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        #clients button.selected {
            background: linear-gradient(120deg,#f68084 0%,#00c6fb 100%);
            border: 2px solid #f68084;
        }
        #messages {
            height: 350px;
            overflow-y: auto;
            background: #f3f6fb;
            border-radius: 18px;
            padding: 18px 12px;
            margin-bottom: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            font-size: 1.07rem;
        }
        .msg {
            display: flex;
            align-items: flex-end;
            margin-bottom: 12px;
        }
        .msg.admin {
            flex-direction: row-reverse;
        }
        .bubble {
            max-width: 75%;
            padding: 12px 18px;
            border-radius: 22px;
            background: #ffe4b5;
            margin: 0 10px;
            color: #222;
            box-shadow: 0 1px 4px rgba(150,150,150,0.07);
            position: relative;
            word-break: break-word;
        }
        .msg.admin .bubble {
            background: linear-gradient(120deg,#00c6fb 0%,#f68084 100%);
            color: #fff;
        }
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #f68084;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #fff;
            font-size: 1.15rem;
            box-shadow: 0 2px 8px rgba(246,128,132,0.13);
        }
        #form {
            display: flex;
            gap: 8px;
        }
        #input {
            flex: 1;
            padding: 13px 15px;
            border-radius: 16px;
            border: 1.5px solid #d4dbe5;
            font-size: 1.08rem;
            outline: none;
            transition: border 0.2s;
        }
        #input:focus {
            border: 1.5px solid #f68084;
        }
        #send {
            background: linear-gradient(120deg,#f68084 0%,#00c6fb 100%);
            color: #fff;
            font-weight: 600;
            padding: 0 22px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: background 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(246,128,132,0.09);
        }
        #send:hover {
            background: linear-gradient(120deg,#00c6fb 0%,#f68084 100%);
        }
        @media (max-width: 600px) {
            .chat-box { padding: 18px 5vw; width: 99vw;}
            #messages { height: 220px; }
        }
    </style>
</head>
<body>
    <div class="chat-box">
        <div class="chat-header">üëë ADMIN CSKH 507</div>
        <div id="clients"></div>
        <div id="messages"></div>
        <form id="form" style="display:none;">
            <input id="input" autocomplete="off" placeholder="Nh·∫≠p tin nh·∫Øn tr·∫£ l·ªùi..." />
            <button id="send" type="submit">Tr·∫£ l·ªùi</button>
        </form>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentId = '';
        let currentName = '';
        let selectedBtn = null;

        socket.emit('admin');

        socket.on('clients', function(list) {
            const clients = document.getElementById('clients');
            clients.innerHTML = '<b>Kh√°ch ƒëang online:</b><br>';
            list.forEach(([id, name]) => {
                const btn = document.createElement('button');
                btn.textContent = name + ' (' + id.slice(0,6) + ')';
                btn.onclick = () => {
                    currentId = id;
                    currentName = name;
                    socket.emit('get history', id);
                    document.getElementById('form').style.display = '';
                    if (selectedBtn) selectedBtn.classList.remove('selected');
                    btn.classList.add('selected');
                    selectedBtn = btn;
                };
                clients.appendChild(btn);
                clients.appendChild(document.createTextNode(' '));
            });
        });

        document.getElementById('form').onsubmit = function(e) {
            e.preventDefault();
            const input = document.getElementById('input');
            if (input.value && currentId) {
                socket.emit('admin message', {id: currentId, text: input.value});
                renderMsg('admin', 'B·∫°n', input.value);
                input.value = '';
            }
        };

        function renderMsg(type, user, text) {
            const div = document.createElement('div');
            div.className = 'msg ' + (type === 'admin' ? 'admin' : '');
            div.innerHTML = `
                <div class="avatar">${type === 'admin' ? 'A' : user[0].toUpperCase()}</div>
                <div class="bubble">${text}</div>
            `;
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }

        socket.on('private message', function(msg) {
            renderMsg('user', msg.from, msg.text);
        });

        socket.on('history', function(data) {
            document.getElementById('messages').innerHTML = '';
            if (data && data.messages) {
                data.messages.forEach(msg => {
                    renderMsg(msg.from === 'Admin' ? 'admin' : 'user', msg.from, msg.text);
                });
            }
            document.getElementById('form').style.display = '';
        });
    </script>
</body>
</html>
